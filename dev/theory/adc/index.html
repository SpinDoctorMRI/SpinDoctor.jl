<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Apparent Diffusion Coefficient · SpinDoctor.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://spindoctormri.github.io/SpinDoctor.jl/theory/adc/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="SpinDoctor.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SpinDoctor.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../generated/solve_btpde/">Solve BTPDE</a></li><li><a class="tocitem" href="../../generated/custom_gradients/">Custom gradients</a></li><li><a class="tocitem" href="../../generated/compare_adcs/">Compare ADCs</a></li><li><a class="tocitem" href="../../generated/matrix_formalism/">Matrix Formalism</a></li><li><a class="tocitem" href="../../generated/hardi/">High Angular Resolution</a></li></ul></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="../theory/">Theory</a></li><li><a class="tocitem" href="../btpde/">Bloch-Torrey PDE</a></li><li class="is-active"><a class="tocitem" href>Apparent Diffusion Coefficient</a><ul class="internal"><li><a class="tocitem" href="#adc"><span>Apparent Diffusion Coefficient</span></a></li><li><a class="tocitem" href="#B-value"><span>B-value</span></a></li><li><a class="tocitem" href="#ADC"><span>ADC</span></a></li><li><a class="tocitem" href="#Fitting-the-ADC-from-the-dMRI-signal"><span>Fitting the ADC from the dMRI signal</span></a></li><li><a class="tocitem" href="#HADC"><span>HADC</span></a></li><li><a class="tocitem" href="#STA"><span>Short diffusion time approximation</span></a></li></ul></li><li><a class="tocitem" href="../matrix_formalism/">Matrix Formalism</a></li><li><a class="tocitem" href="../discretization/">Discretization</a></li></ul></li><li><a class="tocitem" href="../../neurons/">Neurons</a></li><li><a class="tocitem" href="../../api/">API Reference</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Theory</a></li><li class="is-active"><a href>Apparent Diffusion Coefficient</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Apparent Diffusion Coefficient</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SpinDoctorMRI/SpinDoctor.jl/blob/main/docs/src/theory/adc.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h2 id="adc"><a class="docs-heading-anchor" href="#adc">Apparent Diffusion Coefficient</a><a id="adc-1"></a><a class="docs-heading-anchor-permalink" href="#adc" title="Permalink"></a></h2><p>Consider a unidirectional gradient <span>$\vec{g}(t) = g f(t) \vec{d}$</span> parametrized by an amplitude <span>$g &gt; 0$</span>, time profile <span>$f : [0, T_\text{echo}] \to [-1, 1]$</span> and direction <span>$\vec{d}$</span> with <span>$\| \vec{d} \| = 1$</span>.</p><p>Some commonly used time profiles (diffusion-encoding sequences) are:</p><ul><li>The pulsed-gradient spin echo (PGSE) sequence <a href="../../references/#Stejskal1965">E. O. Stejskal, J. E. Tanner (1965)</a>:<p class="math-container">\[f(t) =
\begin{cases}
1, \quad &amp; t_1 \leq t \leq t_1+\delta, \\
-1, \quad &amp; t_1 + \Delta &lt; t \leq t_1 + \Delta + \delta, \\
0, \quad &amp; \text{otherwise};
\end{cases}\]</p></li><li>The double pulsed-gradient spin echo (DPGSE) sequence:<p class="math-container">\[f(t) = f_{\delta, \Delta}(t) + f_{\delta, \Delta}\left(t - (\Delta + \delta +
t_\text{pause}) \right),\]</p>where <span>$f_{\delta, \Delta}$</span> is a normal PGSE sequence;</li><li>The oscillating gradient spin echo (OGSE) sequence (here, cos-OGSE) <a href="../../references/#Callaghan1995">Paul T. Callaghan, Janez Stepianik (1995)</a>, <a href="../../references/#Does2003">Mark D. Does, Edward C. Parsons, John C. Gore (2003)</a>:<p class="math-container">\[f(t) =
\begin{cases}
    \cos\left(n \frac{2\pi}{\delta} (t - t_1)\right), \quad &amp; t_1 &lt; t \leq t_1
    + \delta, \\
    -\cos\left(n \frac{2 \pi}{\delta} (t - \Delta - t_1)\right), \quad &amp; t_1 + \Delta &lt; t
    \leq t_1 + \Delta + \delta, \\
    0, \quad &amp; \text{otherwise},
\end{cases}\]</p></li></ul><p>where <span>$t_1 \geq 0$</span> and <span>$t_1 + \Delta \geq T_\text{echo} / 2$</span>.</p><h2 id="B-value"><a class="docs-heading-anchor" href="#B-value">B-value</a><a id="B-value-1"></a><a class="docs-heading-anchor-permalink" href="#B-value" title="Permalink"></a></h2><p>In a DMRI experiment, <span>$f$</span> is usually fixed, while <span>$g$</span> or <span>$\vec{d}$</span> are varied. <span>$S$</span> is usually plotted against a quantity called the <span>$b$</span>-value. The <span>$b$</span>-value depends on <span>$f$</span> and <span>$g$</span>:</p><p class="math-container">\[b(g, f) = \gamma^2 g^2 \int_0^{T_\text{echo}} \left( \int_0^t f(s) \, \mathrm{d} s \right)^2
\, \mathrm{d}t.\]</p><p>For PGSE, the b-value is <a href="../../references/#Stejskal1965">E. O. Stejskal, J. E. Tanner (1965)</a>:</p><p class="math-container">\[b(g, \delta, \Delta) = \gamma^2 g^2 \delta^2 \left( \Delta - \delta / 3 \right).\]</p><p>For the cosine OGSE with <em>integer</em> number of periods <span>$n$</span> in each of the two durations <span>$\delta$</span>, the corresponding <span>$b$</span>-value is <a href="../../references/#Xu2007">J Xu, MD Does, JC Gore (2007)</a>:</p><p class="math-container">\[b(g, \delta) = \gamma^2 g^2 \frac{\delta^3}{4 n^2 \pi^2} = \gamma^2 g^2
\frac{\delta}{\omega^2}.\]</p><p>The reason for these definitions is that in a homogeneous medium, the signal attenuation is <span>$\exp(-\vec{d}^\mathsf{T} \mathbf{D}_0 \vec{d} b)$</span>, where <span>$\mathbf{D}_0$</span> is the intrinsic diffusion tensor.</p><h2 id="ADC"><a class="docs-heading-anchor" href="#ADC">ADC</a><a id="ADC-1"></a><a class="docs-heading-anchor-permalink" href="#ADC" title="Permalink"></a></h2><p>An important quantity that can be derived from the dMRI signal is the &quot;Apparent Diffusion Coefficient&quot; (ADC), which gives an indication of the root mean squared distance travelled by water molecules in the gradient direction <span>$\vec{d}$</span>, averaged over all starting positions:</p><p class="math-container">\[D_\text{ADC} = \left. -\frac{\partial}{\partial b} \log{\frac{S(b)}{S(0)}}\right\vert_{b=0}.\]</p><h2 id="Fitting-the-ADC-from-the-dMRI-signal"><a class="docs-heading-anchor" href="#Fitting-the-ADC-from-the-dMRI-signal">Fitting the ADC from the dMRI signal</a><a id="Fitting-the-ADC-from-the-dMRI-signal-1"></a><a class="docs-heading-anchor-permalink" href="#Fitting-the-ADC-from-the-dMRI-signal" title="Permalink"></a></h2><p>We numerically compute ADC by a polynomial fit of</p><p class="math-container">\[\log\frac{S(b)}{S_\text{initial}} \approx c_0+c_1b+\dots+c_n b^n,\]</p><p>increasing <span>$n$</span> from 1 onwards until we get the value of <span>$c_1$</span> to be stable within a numerical tolerance, where <span>$S_\text{initial} = \int_\Omega \rho(\vec{x}) \, \mathrm{d} \Omega(\vec{x})$</span>. The first coefficient is given by <span>$c_0 = \log \frac{S(0)}{S_\text{initial}}$</span>, which is equal to zero if <span>$T_{2,i} = \infty$</span> for all <span>$i$</span>.</p><p>The ADC may be interpreted as a correction to the intrinsic diffusion coefficient, taking into account the deviation from the free diffusion arising from interior interfaces, non-isotropic diffusion, fluid movements etc. For suffiently small b-values, the signal attenuation is given by</p><p class="math-container">\[\mathrm{e}^{-D_\text{ADC} b}.\]</p><p>Another quantity of interest is a slight generalization of the ADC – an effective diffusion tensor <span>$\mathbf{D}_\text{eff}$</span>. The six coefficients of this symmetric positive tensor is fitted to best approximate the following signal attenuation, for all directions <span>$\vec{d}$</span>:</p><p class="math-container">\[\mathrm{e}^{-\vec{g}^\mathsf{T} \mathbf{D}_\text{eff} \vec{d} b}.\]</p><p>The resulting ADC in direction <span>$\vec{d}$</span> is then given by</p><p class="math-container">\[D_\text{ADC}(\vec{d}) = \vec{d}^\mathsf{T} \mathbf{D}_\text{eff} \vec{d}.\]</p><h2 id="HADC"><a class="docs-heading-anchor" href="#HADC">HADC</a><a id="HADC-1"></a><a class="docs-heading-anchor-permalink" href="#HADC" title="Permalink"></a></h2><p>In a previous work <a href="../../references/#Schiavi2016">Simona Schiavi, Houssem Haddar, Jing-Rebecca Li (2016)</a>, a PDE model for the time-dependent ADC was obtained starting from the Bloch-Torrey equation, using homogenization techniques. In the case of negligible water exchange between compartments (low permeability), there is no coupling between the compartments, at least to the quadratic order in <span>$g$</span>, which is the ADC term. The ADC in compartment <span>$\Omega$</span> is given by</p><p class="math-container">\[D_\text{HADC}(\vec{d}, f) = \vec{d}^\mathsf{T} \mathbf{D} \vec{d} -
\frac{\int_0^{T_\text{echo}} F(t) h(t) \, \mathrm{d}t}{\int_0^{T_\text{echo}} F(t)^2 \,
\mathrm{d} t},\]</p><p>where <span>$F(t) = \int_0^t f(s) \, \mathrm{d}s,$</span> and</p><p class="math-container">\[h(t) = \frac{1}{|\Omega|} \int_{\partial \Omega} \omega(\vec{x}, t) \, \vec{d} \cdot
\vec{n}(\vec{x}) \, \mathrm{d} \Gamma(\vec{x})\]</p><p>is a quantity related to the directional gradient of a function <span>$\omega$</span> that is the solution of the homogeneous diffusion equation with Neumann boundary condition and zero initial condition:</p><p class="math-container">\[\begin{alignedat}{2}
    \frac{\partial}{\partial t} \omega(\vec{x}, t) &amp; = \nabla \cdot \left(\mathbf{D} \nabla
    \omega(\vec{x}, t)\right), \quad &amp; &amp; (\vec{x}, t) \in \Omega \times [0, T_\text{echo}],
    \\
    \omega(\vec{x}, 0) &amp; = 0, \quad &amp; &amp; \vec{x} \in \Omega, \\
    \mathbf{D} \nabla \omega(\vec{x}, t) \cdot \vec{n} &amp; = F(t) \mathbf{D} \vec{d} \cdot
    \vec{n}, \quad &amp;  &amp; \vec{x} \in \partial \Omega,
\end{alignedat}\]</p><p><span>$\vec{n}$</span> being the outward normal. The above set of equations comprise the homogenized model that we call the HADC model.</p><h2 id="STA"><a class="docs-heading-anchor" href="#STA">Short diffusion time approximation</a><a id="STA-1"></a><a class="docs-heading-anchor-permalink" href="#STA" title="Permalink"></a></h2><p>A well-known formula for the ADC in the short diffusion time regime is the following short time approximation (STA) <a href="../../references/#Mitra1992">Partha P Mitra, Pabitra N Sen, Lawrence M Schwartz, Pierre Le Doussal (1992)</a>, <a href="../../references/#Mitra1993">Partha P. Mitra, Pabitra N. Sen, Lawrence M. Schwartz (1993)</a>:</p><p class="math-container">\[D_\text{STA} = \left(1 - \frac{4\sqrt{D_0}}{3 \sqrt{\pi}}\sqrt{\Delta} \frac{{A}}{d\; V}
\right) D_0,\]</p><p>where <span>$\dfrac{A}{V}$</span> is the surface to volume ratio, <span>$d$</span> is the spatial dimension and <span>$D_0 = \vec{d}^\mathsf{T} \mathbf{D} \vec{d}$</span> is the intrinsic diffusion coefficient in the gradient direction. In the above formula, the pulse duration <span>$\delta$</span> is assumed to be very small compared to <span>$\Delta$</span>. A recent correction to the above formula <a href="../../references/#Schiavi2016">Simona Schiavi, Houssem Haddar, Jing-Rebecca Li (2016)</a>, taking into account the finite pulse duration <span>$\delta$</span> and the gradient direction <span>$\vec{d}$</span>, is the following:</p><p class="math-container">\[D_\text{STA} = \left(1 - \frac{4 \sqrt{D_0}}{3 \sqrt{\pi}} C_{\delta,\Delta}
\frac{A_{\vec{d}}}{V} \right) D_0,\]</p><p>where</p><p class="math-container">\[A_{\vec{d}} = \int_{\partial \Omega} \left(\vec{d} \cdot \vec{n}(\vec{x})\right)^2 \,
\mathrm{d} \Gamma(\vec{x}) = \vec{d}^\mathsf{T} \mathbf{N} \vec{d}\]</p><p>with <span>$\mathbf{N} = \int_{\partial \Omega} \vec{n}(\vec{x}) \vec{n}^\mathsf{T}\!(\vec{x}) \, \mathrm{d} \Gamma(\vec{x})$</span> and</p><p class="math-container">\[C_{\delta, \Delta} = \dfrac{4}{35} \dfrac{\left(\Delta + \delta \right)^{7 / 2}+
\left(\Delta - \delta\right)^{7 / 2} - 2 \left(\delta^{ 7 / 2} + \Delta^{7 / 2}
\right)}{\delta^2 \left( \Delta - \delta / 3\right)} = \sqrt{\Delta} \left(1 + \dfrac{1}{3}
\dfrac{\delta}{\Delta} - \dfrac{8}{35} \left(\dfrac{\delta}{\Delta}\right)^{3 / 2} + \dots
\right).\]</p><p>When <span>$\delta \ll \Delta$</span>, the value <span>$C_{\delta, \Delta}$</span> is approximately <span>$\sqrt{\Delta}$</span>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../btpde/">« Bloch-Torrey PDE</a><a class="docs-footer-nextpage" href="../matrix_formalism/">Matrix Formalism »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Sunday 4 September 2022 18:59">Sunday 4 September 2022</span>. Using Julia version 1.8.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
