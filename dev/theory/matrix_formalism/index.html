<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Matrix Formalism · SpinDoctor.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://spindoctormri.github.io/SpinDoctor.jl/theory/matrix_formalism/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="SpinDoctor.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SpinDoctor.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../generated/solve_btpde/">Solve BTPDE</a></li><li><a class="tocitem" href="../../generated/custom_gradients/">Custom gradients</a></li><li><a class="tocitem" href="../../generated/compare_adcs/">Compare ADCs</a></li><li><a class="tocitem" href="../../generated/matrix_formalism/">Matrix Formalism</a></li><li><a class="tocitem" href="../../generated/hardi/">High Angular Resolution</a></li></ul></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="../theory/">Theory</a></li><li><a class="tocitem" href="../btpde/">Bloch-Torrey PDE</a></li><li><a class="tocitem" href="../adc/">Apparent Diffusion Coefficient</a></li><li class="is-active"><a class="tocitem" href>Matrix Formalism</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Eigenvalue-decomposition-of-the-generalized-Laplace-operator"><span>Eigenvalue decomposition of the generalized Laplace operator</span></a></li><li><a class="tocitem" href="#Bloch-Torrey-operator-in-the-Laplace-eigenfunction-basis"><span>Bloch-Torrey operator in the Laplace eigenfunction basis</span></a></li><li><a class="tocitem" href="#Matrix-Formalism-approximation"><span>Matrix Formalism approximation</span></a></li><li><a class="tocitem" href="#Apparent-diffusion-coefficient"><span>Apparent diffusion coefficient</span></a></li><li><a class="tocitem" href="#Eigenfunction-length-scale-and-orientation"><span>Eigenfunction length scale and orientation</span></a></li></ul></li><li><a class="tocitem" href="../discretization/">Discretization</a></li></ul></li><li><a class="tocitem" href="../../neurons/">Neurons</a></li><li><a class="tocitem" href="../../api/">API Reference</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Theory</a></li><li class="is-active"><a href>Matrix Formalism</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Matrix Formalism</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SpinDoctorMRI/SpinDoctor.jl/blob/main/docs/src/theory/matrix_formalism.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Matrix-formalism"><a class="docs-heading-anchor" href="#Matrix-formalism">Matrix formalism</a><a id="Matrix-formalism-1"></a><a class="docs-heading-anchor-permalink" href="#Matrix-formalism" title="Permalink"></a></h1><p>The Matrix Formalism <a href="../../references/#Callaghan1997">Paul Callaghan (1997)</a>, <a href="../../references/#Barzykin1999">Alexandre V Barzykin (1999)</a> representation of the solution to the Bloch-Torrey PDE is based on the generalized Laplace eigenfunctions of the given geometrical configuration. These are the eigenfunctions of the generalized Laplace operator <span>$-\nabla \cdot \mat{D} \nabla$</span> subject to the same boundary and interface conditions as the BTPDE. It which does not depend on the gradient sequence. The Matrix Formalism truncates the number of Laplace eigenmodes at an acceptable level, by setting a minimum length scale for the eigenfunctions. The gradient sequence dependent Bloch-Torrey operator can then be expressed in the truncated Laplace eigenfunction basis. This allows for a simple analytical expression which approximates the solution to the BTPDE down to an arbitrary length scale.</p><h1 id="Eigenvalue-decomposition-of-the-generalized-Laplace-operator"><a class="docs-heading-anchor" href="#Eigenvalue-decomposition-of-the-generalized-Laplace-operator">Eigenvalue decomposition of the generalized Laplace operator</a><a id="Eigenvalue-decomposition-of-the-generalized-Laplace-operator-1"></a><a class="docs-heading-anchor-permalink" href="#Eigenvalue-decomposition-of-the-generalized-Laplace-operator" title="Permalink"></a></h1><p>Let <span>$\{(\phi, \lambda)\}$</span> be the <span>$L^2$</span>-normalized eigenfunctions and eigenvalues of the generalized Laplace operator <span>$\nabla \cdot \mathbf{D} \nabla$</span>, defined almost everywhere on the domain <span>$\Omega = \bigcup_{i = 1}^{N_\text{cmpt}} \Omega_i$</span>. Denoting <span>$\phi^i$</span> the restriction of <span>$\phi$</span> to compartment <span>$\Omega_i$</span>, the eigenfunctions respect the following set of equations, for <span>$(i, j) \in \{1, \dots, N_\text{cmpt}\}^2$</span>:</p><p class="math-container">\[-\nabla \cdot \mathbf{D}_i \nabla \phi^i(\vec{x}) = \lambda \phi^i(\vec{x}), \quad \vec{x} \in
\Omega_i, \quad i \in \{1, \dots, N_\text{cmpt}\}.\]</p><p>where the boundary conditions are the same as for the BTPDE:</p><p class="math-container">\[\begin{alignedat}{3}
    \mathbf{D}_i \nabla \phi^i(\vec{x}) \cdot \vec{n}_i(\vec{x}) &amp; = -\mathbf{D}_j \nabla
    \phi^j(\vec{x}) \cdot \vec{n}_j(\vec{x}), \quad &amp; &amp; \vec{x} \in \Gamma_{i j}, \quad (i,
    j) \in \{1, \dots, N_\text{cmpt}\}^2, &amp; \\
    \mathbf{D}_i \nabla \phi^i(\vec{x}) \cdot \vec{n}_i(\vec{x}) &amp; = \kappa_{i j} \left(c_{i j}
    \phi^j(\vec{x}) - c_{j i}\phi^i(\vec{x})\right), \quad &amp; &amp; \vec{x} \in \Gamma_{i j},
    \quad (i, j) \in \{1, \dots, N_\text{cmpt}\}^2, &amp;\\
    \mathbf{D}_i \nabla \phi^i(\vec{x}) \cdot \vec{n}_i(\vec{x}) &amp; = -\kappa_i \phi^i(\vec{x}),
    \quad &amp; &amp; \vec{x} \in \Gamma_i, \quad i \in \{1, \dots, N_\text{cmpt}\}. &amp;
\end{alignedat}\]</p><p>Let the solutions <span>$(\phi, \lambda)$</span> to the above equations be denoted by <span>$\left\{(\phi_n, \lambda_n)\right\}_{n \in \mathbb{N}^*}$</span>. We assume the non-negative real-valued eigenvalues are ordered in non-decreasing order:</p><p class="math-container">\[0 = \lambda_1 \leq \lambda_2 \leq \lambda_3 \leq \dots\]</p><p>If the domain <span>$\Omega$</span> consists of only one contiguous group of compartments connected through a chain of permeable membranes, only the first eigenvalue will be zero, and the corresponding eigenfunction will be the only constant function. If there are <span>$N_\text{group} \geq 2$</span> groups of connected compartments completely separated by interior hard wall membranes, the first <span>$N_\text{group}$</span> eigenvalues will be zero:</p><p class="math-container">\[0 = \lambda_1 = \dots = \lambda_{N_\text{group}} &lt; \lambda_{N_\text{group} + 1} \leq \dots,\]</p><p>and there will be <span>$N_\text{group}$</span> corresponding groupwise constant eigenfunctions. In the latter case, the equations may be rewritten separately for each connected subdomain to obtain a set of eigenvalues with a multiplicity of one, but the formulation is also valid in the global form with multiple zero eigenvalues. These two formulations will lead to an identical eigenfunction basis (up to a linear combination for the eigenvalues with multiplicity higher than one), where the basis of each subdomain is a subset of the global eigenfunction basis.</p><p>Let <span>$\mathbf{L}$</span> be the diagonal matrix containing the first <span>$N_\text{eig}$</span> Laplace eigenvalues:</p><p class="math-container">\[\mathbf{L} = \operatorname{diag}(\lambda_1, \lambda_2, \dots, \lambda_{N_\text{eig}})\in
\R^{N_\text{eig} \times N_\text{eig}}.\]</p><p>Then the matrix <span>$\mathbf{L}$</span> represents the generalized Laplace operator <span>$-\nabla \cdot \mathbf{D} \nabla$</span> in the truncated Laplace eigenfunction basis.</p><h2 id="Bloch-Torrey-operator-in-the-Laplace-eigenfunction-basis"><a class="docs-heading-anchor" href="#Bloch-Torrey-operator-in-the-Laplace-eigenfunction-basis">Bloch-Torrey operator in the Laplace eigenfunction basis</a><a id="Bloch-Torrey-operator-in-the-Laplace-eigenfunction-basis-1"></a><a class="docs-heading-anchor-permalink" href="#Bloch-Torrey-operator-in-the-Laplace-eigenfunction-basis" title="Permalink"></a></h2><p>Let <span>$\mathbf{A}(\vec{g})$</span> be the <span>$N_\text{eig} \times N_\text{eig}$</span> matrix defined by:</p><p class="math-container">\[\mathbf{A}(\vec{g}) = g_x \mathbf{A}^x + g_y \mathbf{A}^y + g_z \mathbf{A}^z,\]</p><p>where <span>$\vec{g} = (g_x, g_y, g_z)^\mathsf{T}$</span> is the gradient vector and <span>$\mathbf{A}^x$</span>, <span>$\mathbf{A}^y$</span>, and <span>$\mathbf{A}^z$</span> are three symmetric <span>$N_\text{eig} \times N_\text{eig}$</span> matrices whose entries are the first order moments in the coordinate directions of the product of pairs of eigenfunctions:</p><p class="math-container">\[\begin{alignedat}{3}
    A_{mn}^x &amp; = \int_\Omega x \, \phi_m(\vec{x}) \phi_n(\vec{x}) \, \mathrm{d}
    \Omega(\vec{x}), \quad &amp; &amp; (m, n) \in \{1, \dots, N_\text{eig}\}^2, \\
    A_{mn}^y &amp; = \int_\Omega y \, \phi_m(\vec{x}) \phi_n(\vec{x}) \, \mathrm{d}
    \Omega(\vec{x}), \quad &amp; &amp; (m, n) \in \{1, \dots, N_\text{eig}\}^2, \\
    A_{mn}^z &amp; = \int_\Omega z \, \phi_m(\vec{x}) \phi_n(\vec{x}) \, \mathrm{d}
    \Omega(\vec{x}), \quad &amp; &amp; (m, n) \in \{1, \dots, N_\text{eig}\}^2.
\end{alignedat}\]</p><p>Similarly, let <span>$\mathbf{T}$</span> be the <span>$N_\text{eig} \times N_\text{eig}$</span> Laplace relaxation matrix defined by</p><p class="math-container">\[T_{mn} = \int_\Omega \frac{1}{T_2(\vec{x})} \phi_m(\vec{x}) \phi_n(\vec{x}) \, \mathrm{d}
\Omega(\vec{x}), \quad (m,n) \in \{1, \dots, N_\text{eig}\}^2.\]</p><p>Then the general time dependent Bloch-Torrey operator</p><p class="math-container">\[-\nabla \cdot \mathbf{D} \nabla + \frac{1}{T_2} + \underline{\mathrm{i}} \gamma \vec{g}(t)
\cdot \vec{x}, \quad t \in [0, T_\text{echo}]\]</p><p>in the truncated Laplace eigenfunction basis <span>$(\phi_j)_{j = 1, \dots, N_\text{eig}}$</span> is given by the complex-valued matrix</p><p class="math-container">\[\mathbf{K}(\vec{g}(t)) = \mathbf{L} + \mathbf{T} + \underline{\mathrm{i}} \gamma
\mathbf{A}(\vec{g}(t)), \quad t \in [0, T_\text{echo}].\]</p><h2 id="Matrix-Formalism-approximation"><a class="docs-heading-anchor" href="#Matrix-Formalism-approximation">Matrix Formalism approximation</a><a id="Matrix-Formalism-approximation-1"></a><a class="docs-heading-anchor-permalink" href="#Matrix-Formalism-approximation" title="Permalink"></a></h2><p>Denoting <span>$\vec{\phi} = (\phi_1, \dots, \phi_{N_\text{eig}})^\mathsf{T}$</span> the vector of the first <span>$N_\text{eig}$</span> Laplace eigenfunctions, we may project the solution to to the Bloch-Torrey PDE onto the truncated Laplace eigenfunction basis:</p><p class="math-container">\[M^\text{MF}(\vec{x}, t) = \vec{\phi}^\mathsf{T}\!(\vec{x}) \vec{\nu}(t),\]</p><p>where the vector of coefficients <span>$\vec{\nu} = (\nu_1, \dots, \nu_{N_\text{eig}})^\mathsf{T} : [0, T_\text{echo}] \to \mathbb{C}^{N_\text{eig}}$</span> is the solution to</p><p class="math-container">\[\frac{\mathrm{d} \vec{\nu}}{\mathrm{d} t} = -\mathbf{K}(\vec{g}(t)) \vec{\nu}(t), \quad t
\in [0, T_\text{echo}].\]</p><p>The initial coefficients are given by</p><p class="math-container">\[\vec{\nu}(0) = \int_\Omega \rho(\vec{x}) \vec{\phi}(\vec{x}) \, \mathrm{d} \Omega(\vec{x}).\]</p><p>By using a piece-wise constant approximation of the gradient <span>$\vec{g}$</span> <a href="../../references/#Barzykin1999">Alexandre V Barzykin (1999)</a>, we obtain</p><p class="math-container">\[\vec{\nu}(T_\text{echo}) \approx \left(\prod_{i = 1}^{N_\text{int}} \mathrm{e}^{-\delta_i
\mathbf{K}_i}\right) \vec{\nu}(0) = \mathrm{e}^{-\delta_{N_\text{int}}
\mathbf{K}_{N_\text{int}}} \dots \mathrm{e}^{-\delta_2 \mathbf{K}_2} \mathrm{e}^{-\delta_1
\mathbf{K}_1} \vec{\nu}(0),\]</p><p>where <span>$\{I_i\}_{i = 1, \dots, N_\text{int}}$</span> are intervals such that <span>$[0, T_\text{echo}] = \bigcup_{i = 1}^{N_\text{int}} I_i$</span>, <span>$\vec{g}(t) = \vec{g}_i$</span> for <span>$t \in I_i$</span>, <span>$\delta_i = |I_i|$</span>, and <span>$\mathbf{K}_i = \mathbf{K}(\vec{g}_i)$</span>. The constants may be computed through quadrature:</p><p class="math-container">\[\vec{g}_i = \frac{1}{\delta_i}\int_{I_i} \vec{g}(t) \, \mathrm{d} t \approx \frac{1}{2}
\left(\vec{g}(\min I_i) + \vec{g}(\max I_i)\right).\]</p><p>For the PGSE and double-PGSE sequences <span>$\vec{g}(t) = f(t) g \vec{d}$</span>, where <span>$f(t) \in \{-1, 0, 1\}$</span> for all <span>$t$</span>, the coefficients of the final magnetization are given by</p><p class="math-container">\[\vec{\nu}(T_\text{echo}) = \mathrm{e}^{-\delta\mathbf{K}(g \vec{d})^*} \mathrm{e}^{-(\Delta -
\delta)(\mathbf{L} + \mathbf{T})} \mathrm{e}^{-\delta \mathbf{K}(g \vec{d}} \vec{\nu}(0)\]</p><p>and</p><p class="math-container">\[\vec{\nu}(T_\text{echo}) = \mathrm{e}^{-\delta \mathbf{K}(g \vec{d})^*} \mathrm{e}^{-(\Delta
- \delta)(\mathbf{L} + \mathbf{T})} \mathrm{e}^{-\delta \mathbf{K}(g \vec{d})}
\mathrm{e}^{-t_\text{pause}(\mathbf{L}
+ \mathbf{T})} \mathrm{e}^{-\delta \mathbf{K}(g \vec{d})^*} \mathrm{e}^{-(\Delta -
+ \delta)(\mathbf{L} +
\mathbf{T})} \mathrm{e}^{-\delta \mathbf{K}(g \vec{d})} \vec{\nu}(0)\]</p><p>respectively. These are the exact solutions, although there may still be truncation errors from <span>$N_\text{eig}$</span>.</p><p>The signal is given by</p><p class="math-container">\[S^\text{MF}(f, \vec{g}) = \vec{\nu}^\mathsf{T}\!(T_\text{echo}) \int_\Omega
\vec{\phi}(\vec{x}) \, \mathrm{d} \Omega(\vec{x}).\]</p><h2 id="Apparent-diffusion-coefficient"><a class="docs-heading-anchor" href="#Apparent-diffusion-coefficient">Apparent diffusion coefficient</a><a id="Apparent-diffusion-coefficient-1"></a><a class="docs-heading-anchor-permalink" href="#Apparent-diffusion-coefficient" title="Permalink"></a></h2><p>From the Matrix Formalism signal, the analytical expression of its ADC for a gradient direction given by a unit vector <span>$\vec{d}$</span> and a sequence <span>$f$</span> is the following:</p><p class="math-container">\[D^\text{MF}(\vec{d}, f) = \frac{1}{|\Omega|} \sum_{n = 1}^{N_\text{eig}} (\vec{d} \cdot
\vec{a}_n)^2 \lambda_n \frac{\int_0^{T_\text{echo}} F(t) \int_0^t \mathrm{e}^{-\lambda_n(t -
s)} f(s) \, \mathrm{d} s \, \mathrm{d} t}{ \int_0^{T_\text{echo}} F^2(t) \, \mathrm{d} t},\]</p><p>where the coefficients of the three-row matrix <span>$\mathbf{a} = (\vec{a}_1^, \dots, \vec{a}_{N_\text{eig}}) \in \mathbb{R}^{3 \times N_\text{eig}}$</span> are given by</p><p class="math-container">\[\begin{split}
    a_n^x &amp; = \int_{\Omega} x \phi_n(\vec{x}) \, \mathrm{d} \Omega(\vec{x}), \\
    a_n^y &amp; = \int_{\Omega} y \phi_n(\vec{x}) \, \mathrm{d} \Omega(\vec{x}), \\
    a_n^z &amp; = \int_{\Omega} z \phi_n(\vec{x}) \, \mathrm{d} \Omega(\vec{x}),
\end{split}
\quad n \in \{1, \dots, N_\text{eig}\}.\]</p><p>To clarify the relationship between the ADC and the diffusion encoding direction <span>$\vec{d}$</span>, we rewrite the Matrix Formalism ADC as</p><p class="math-container">\[D^\text{MF}(\vec{d}, f) = \vec{d}^\mathsf{T} \mathbf{D}^{\text{MF}}(f) \vec{d},\]</p><p>where the Matrix Formalism effective diffusion tensor is given by</p><p class="math-container">\[\mathbf{D}^{\text{MF}}(f) = \frac{1}{|\Omega|} \sum_{n = 1}^{N_\text{eig}} j_n(f) \vec{a}_n
\vec{a}_n^\mathsf{T} = \frac{1}{|\Omega|} \mathbf{a} \mathbf{j}(f) \mathbf{a}^\mathsf{T},\]</p><p>with <span>$\mathbf{j}(f) = \operatorname{diag}\left(j_1(f), \dots, j_{N_\text{eig}}(f)\right) \in \mathbb{R}^{N_\text{eig} \times N_\text{eig}}$</span> depending on <span>$f$</span>:</p><p class="math-container">\[j_n(f) = \lambda_n \frac{\int_0^{T_\text{echo}} F(t) \int_0^t e^{-\lambda_n(t - s)} f(s) \,
\mathrm{d} s \, \mathrm{d} t}{\int_0^{T_\text{echo}} F^2(t) \, \mathrm{d} t}, \quad n \in
\{1, \dots, N_\text{eig}\}.\]</p><p>In the case of a constant initial spin density <span>$\rho$</span>, we also allow for computing the Matrix Formalism Gaussian Approximation (MFGA) signal, given as</p><p class="math-container">\[S^{\text{MFGA}}(g, f, \vec{d}) = \rho |\Omega| \exp\left(-\vec{d}^\mathsf{T}
\mathbf{D}^{\text{MF}}(f) \vec{d} \; b(g, f) \right) }.\]</p><h2 id="Eigenfunction-length-scale-and-orientation"><a class="docs-heading-anchor" href="#Eigenfunction-length-scale-and-orientation">Eigenfunction length scale and orientation</a><a id="Eigenfunction-length-scale-and-orientation-1"></a><a class="docs-heading-anchor-permalink" href="#Eigenfunction-length-scale-and-orientation" title="Permalink"></a></h2><p>On a line segment of length <span>$L$</span> and diffusivity <span>$D_0$</span>, the eigenvalues <span>$(\lambda_1, \lambda_2, \dots)$</span> of the Laplace operator with Neumann boundary conditions are</p><p class="math-container">\[\lambda_n = \left(\frac{\pi (n - 1)}{L}\right)^2 D_0, \quad n = 1, 2, \dots\]</p><p>To make the link between the computed eigenvalue and the spatial scale of the eigenmode, we will convert the computed <span>$\lambda_n$</span> into a length scale:</p><p class="math-container">\[\ell(\lambda) =
\begin{cases}
    + \infty, \quad                                &amp; \lambda = 0, \\
    \pi \sqrt{\frac{\bar{\sigma}}{\lambda}}, \quad &amp; \lambda &gt; 0,
\end{cases}\]</p><p>and characterize the computed eigenmode by <span>$\ell(\lambda_n)$</span> instead of <span>$\lambda_n$</span>. The reference diffusivity <span>$\bar{\sigma}$</span> is taken as a volume weighted mean of the trace average (spherical part) of <span>$(\mathbf{D}_i)_{1 \leq i \leq N_\text{cmpt}}$</span>:</p><p class="math-container">\[\bar{\sigma} = \frac{1}{|\Omega|} \int_\Omega \frac{1}{3}\operatorname{tr} \mathbf{D}(\vec{x})
\, \mathrm{d} \Omega(\vec{x}).\]</p><p>To characterize the directional contribution of the eigenmode we use the fact that its contribution to the ADC in the direction <span>$\vec{d}$</span> is <span>$j_n(f) (\vec{d} \cdot \vec{a}_n)^2$</span>. We thus call <span>$\vec{a}_n = (a_n^x, a_n^y, a_n^z)^\mathsf{T}$</span> the &quot;diffusion direction&quot; of the <span>$n$</span>th eigenmode. We remind that the three components of <span>$\vec{a}_n$</span> are the first moments in the 3 canonical basis directions of the associated eigenfunction.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../adc/">« Apparent Diffusion Coefficient</a><a class="docs-footer-nextpage" href="../discretization/">Discretization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Sunday 22 January 2023 10:26">Sunday 22 January 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
